<!-- templates/base.html -->
{% extends 'base.html' %}

{% load static %}

{% block extra_head %}
<link rel="icon" href="{% static 'favicon.ico' %}" />
<script src="{% static 'js/marked.min.js' %}"></script>


<style>
  body {
    background-image: url('{% static "images/sfondo.png" %}');
    background-size: cover;
    background-position: right top;
    background-attachment: fixed;

  }

  .mini {
    transform: scale(0.85);
    transform-origin: top left; /* mantiene l'allineamento in alto a sinistra */
  }

</style>
{% endblock %}


{% block page_title %}
App IO smartphone preview - OpenMSP - Multi Services Portal
{% endblock %}

{% block centered_container %}
<h3>App IO - Anteprima invio messaggio</h3>
<br />

<div class="container-fluid">
    <div class="row">
        <!-- Colonna Sinistra: Preview Smartphone -->
        <div class="col-5 d-flex justify-content-center">
            <!-- Cornice dello smartphone con immagine -->
            <div class="iphone-frame" style="position: relative; width: 400px; height: 750px; background-image: url('{% static 'images/iphone-frame.png' %}'); background-size: contain; background-repeat: no-repeat; background-position: center;">
                <!-- Contenuto del messaggio -->
                <div class="d-flex justify-content-center align-items-center" style="height: 100%; padding: 70px 32px 48px 32px;">
                    <div class="bg-white d-flex flex-column" style="width: 90%; height: 100%; overflow-y: auto; overflow-x: hidden; border-radius: 40px;">
                        
                        <!-- Header App -->
                        <div class="d-flex justify-content-between align-items-center p-3">
                            <svg class="icon icon-sm"><use href="{% static 'svg/sprites.svg' %}#it-arrow-left"></use></svg>
                            <svg class="icon icon-sm"><use href="{% static 'svg/sprites.svg' %}#it-help-circle"></use></svg>
                        </div>

                        <div class="px-3 pb-3 flex-grow-1">
                            <!-- Titolo -->
                            <h3 class="h4 mb-1"><strong>{{ data.2 }}</strong></h3>
                            <p class="text-secondary small mb-3">{% now "d M Y, H:i" %}</p>

                            <!-- Mittente e Servizio -->
                            <div class="mb-4 border-bottom pb-3">
                                <p class="mb-0 font-weight-bold text-secondary">{{ my_ente }}</p>
                                {% for dato_servizio in dati_servizio %}
                                    {% if dato_servizio.id|stringformat:"s" == data.1 %}
                                        <div class="d-flex justify-content-between align-items-center">
                                            <a href="#" class="text-primary font-weight-bold text-decoration-none">{{ dato_servizio.servizio }}</a>
                                            <!-- Logo ente -->
                                            <img class="icon" src="data:image/png;base64,{{ my_logo }}" style="width: 24px; height: 24px; border-radius: 50%;" /> 
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <!-- Avviso Scadenza -->
                            {% if data.5 %}
                            <div class="rounded p-3 mb-4" style="background-color: #FFF8E1;">
                                <div class="d-flex">
                                    <svg class="icon icon-warning me-2 mt-1" style="fill: #A67C00;"><use href="{% static 'svg/sprites.svg' %}#it-warning-circle"></use></svg>
                                    <div>
                                        <p class="mb-1" style="color: #5C4B00;">Scade il {{ data.7 }} alle ore 23:59</p>
                                        <p class="mb-0 font-weight-bold" style="color: #5C4B00;">Aggiungi promemoria</p>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Header Messaggio -->
                            <h6 class="text-uppercase text-secondary font-weight-bold mb-2" style="font-size: 0.8rem;">MESSAGGIO</h6>
                            
                            <!-- Corpo Messaggio -->
                            <div class="mb-4 text-dark" style="line-height: 1.5;">
                                {{ data.4|safe|linebreaks }}
                            </div>

                            <!-- Sezione PagoPA -->
                            {% if data.8 %}
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-2">
                                    <img src="{% static 'images/pagopa-logo.png' %}" width="35" height="35" alt="pagoPA" />
                                    <span class="font-weight-bold text-secondary">Avvisi pagoPA</span>
                                </div>
                                <div class="card border shadow-sm">
                                    <div class="card-body p-3">
                                        <p class="small text-secondary mb-1">Codice avviso</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="font-weight-bold text-primary" style="font-size: 1.1rem; letter-spacing: 1px;">{{ data.9 }}</span>
                                            <svg class="icon icon-primary icon-sm"><use href="{% static 'svg/sprites.svg' %}#it-chevron-right"></use></svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                        </div>

                        <!-- Footer Actions -->
                        <div class="p-3 bg-light mt-auto border-top">
                            <div class="d-flex align-items-center mb-3 text-primary">
                                <svg class="icon icon-primary icon-sm me-2"><use href="{% static 'svg/sprites.svg' %}#it-comment"></use></svg>
                                <span class="font-weight-bold">Contatta il mittente</span>
                            </div>
                            <div class="d-flex align-items-center mb-4 text-primary">
                                <svg class="icon icon-primary icon-sm me-2"><use href="{% static 'svg/sprites.svg' %}#it-info-circle"></use></svg>
                                <span class="font-weight-bold">Mostra altri dati</span>
                            </div>

                            <!-- Bottoni Dinamici -->
                            {% if data.8 %}
                                <button class="btn btn-primary w-100 mb-3 rounded fw-bold">Paga 10,00 €</button>
                            {% endif %}

                            {% if data.10 %}
                                <button class="btn btn-primary w-100 mb-3 rounded fw-bold">{{ data.12 }}</button>
                            {% endif %}

                            {% if data.14 %}
                                <div class="text-center">
                                    <a href="#" class="text-decoration-none font-weight-bold">{{ data.16 }}</a>
                                </div>
                            {% endif %}
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Colonna Destra: Azioni -->
        <div class="col-5">
            <div class="sticky-top pt-5">
                
                <!-- Callout per azione principale -->
                <div class="callout callout-highlight success">
                    <div class="callout-title">
                        <svg class="icon"><use href="{% static 'svg/sprites.svg' %}#it-check-circle"></use></svg>
                        Conferma Invio
                    </div>
                    <p>Hai verificato tutti i dati nell'anteprima? Se è tutto corretto, procedi con l'invio del messaggio al cittadino.</p>
                    
                    <form class="needs-validation mt-4" id="app_io_singolo_conferma" method="post" action="">
                        {% csrf_token %}
                        <input type="hidden" name="conferma" value=True>
                        <input type="hidden" name="input_CF" value="{{ data.0 }}">
                        <input type="hidden" name="sceltaServizio" value="{{ data.1 }}">
                        <input type="hidden" name="subject" value="{{ data.2 }}">
                        <input type="hidden" name="MessageArea" value="{{ data.3 }}">
                        {% for dato_servizio in dati_servizio %}
                            {% if dato_servizio.id|stringformat:"s" == data.1 %}
                                <input type="hidden" name="id_servizio" value="{{dato_servizio.id}}">
                            {% endif %}
                        {% endfor %}
                        
                        {% if data.5 %}
                            <input type="hidden" name="dataScadenza" value="{{ data.7 }}">
                        {% endif %}
                        
                        {% if data.8 %}
                            <input type="hidden" name="input_IUV" value="{{ data.9 }}">
                        {% endif %}
                        
                        {% if data.10 %}
                            <input type="hidden" name="radio_bottone1" value="{{ data.11 }}">
                            <input type="hidden" name="testo_bottone1" value="{{ data.12 }}">
                            <input type="hidden" name="comando_bottone1" value="{{ data.13 }}">
                        {% endif %}
                        
                        {% if data.14 %}
                            <input type="hidden" name="radio_bottone2" value="{{ data.15 }}">
                            <input type="hidden" name="testo_bottone2" value="{{ data.16 }}">
                            <input type="hidden" name="comando_bottone2" value="{{ data.17 }}">
                        {% endif %}

                        <div class="d-grid gap-3">
                            <button id="verificaButton" name="verificaButton" class="btn btn-primary btn-lg shadow" type="submit">
                                <span class="font-weight-bold">CONFERMA E INVIA</span>
                                <svg class="icon icon-white ms-2"><use href="{% static 'svg/sprites.svg' %}#it-telegram"></use></svg>
                            </button>
                            
                            <button id="backButton" class="btn btn-outline-danger btn-sm" type="button" onclick="window.history.back();">
                                <svg class="icon icon-danger me-2"><use href="{% static 'svg/sprites.svg' %}#it-arrow-left"></use></svg>
                                Torna alle modifiche
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Info box aggiuntivo opzionale -->
                <div class="alert alert-info mt-4" role="alert">
                  <div class="d-flex align-items-center">
                     <span class="small">Il messaggio verrà accodato per l'invio immediato.</span>
                  </div>
                </div>

            </div>
        </div>
    </div>
</div>

{% endblock %}
